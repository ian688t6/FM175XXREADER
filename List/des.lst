C51 COMPILER V9.54   DES                                                                   03/18/2019 11:21:00 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE DES
OBJECT MODULE PLACED IN .\Output\des.obj
COMPILER INVOKED BY: E:\Tools\Keil5\C51\BIN\C51.EXE des.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Inc) DEBUG OBJECTEXTEN
                    -D PRINT(.\List\des.lst) OBJECT(.\Output\des.obj)

line level    source

   1          #include "STC15F2K60S2.h"
   2          #include <string.h>
   3          #include "des.h"
   4          
   5          #define uchar unsigned char
   6          #define uint  unsigned int
   7          
   8          
   9          
  10          
  11          uchar xdata  lk[4]={0,0,0,0};
  12          uchar xdata  rk[4]={0,0,0,0};
  13          uchar xdata  oo[4]={0,0,};
  14          uchar xdata  pp[4]={0,0,};
  15          uchar xdata  blck[9]={0,0,0,};
  16          uchar xdata  fnc[4]={0,0,0,0};
  17          
  18          
  19          
  20          
  21          
  22          uchar xdata  enckey[96]={0,0,};
  23          uchar xdata  deckey[96]={0,0,};
  24          uchar xdata  skey[6]={0,0,};
  25          uchar xdata  ls[16]={1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1};
  26          
  27           const  uchar code      
  28                  S_BOX1[64]= {
  29                          0xe,0x0,0x4,0xf,0xd,0x7,0x1,0x4,
  30                          0x2,0xe,0xf,0x2,0xb,0xd,0x8,0x1,
  31                          0x3,0xa,0xa,0x6,0x6,0xc,0xc,0xb,
  32                          0x5,0x9,0x9,0x5,0x0,0x3,0x7,0x8,
  33                          0x4,0xf,0x1,0xc,0xe,0x8,0x8,0x2,
  34                          0xd,0x4,0x6,0x9,0x2,0x1,0xb,0x7,
  35                          0xf,0x5,0xc,0xb,0x9,0x3,0x7,0xe,
  36                          0x3,0xa,0xa,0x0,0x5,0x6,0x0,0xd,
  37                  },
  38          
  39                  S_BOX2[64]= {
  40                          0xf,0x3,0x1,0xd,0x8,0x4,0xe,0x7,
  41                          0x6,0xf,0xb,0x2,0x3,0x8,0x4,0xe,
  42                          0x9,0xc,0x7,0x0,0x2,0x1,0xd,0xa,
  43                          0xc,0x6,0x0,0x9,0x5,0xb,0xa,0x5,
  44                          0x0,0xd,0xe,0x8,0x7,0xa,0xb,0x1,
  45                          0xa,0x3,0x4,0xf,0xd,0x4,0x1,0x2,
  46                          0x5,0xb,0x8,0x6,0xc,0x7,0x6,0xc,
  47                          0x9,0x0,0x3,0x5,0x2,0xe,0xf,0x9,
  48                  },
  49          
  50                  S_BOX3[64]= {
  51                          0xa,0xd,0x0,0x7,0x9,0x0,0xe,0x9,
  52                          0x6,0x3,0x3,0x4,0xf,0x6,0x5,0xa,
  53                          0x1,0x2,0xd,0x8,0xc,0x5,0x7,0xe,
  54                          0xb,0xc,0x4,0xb,0x2,0xf,0x8,0x1,
C51 COMPILER V9.54   DES                                                                   03/18/2019 11:21:00 PAGE 2   

  55                          0xd,0x1,0x6,0xa,0x4,0xd,0x9,0x0,
  56                          0x8,0x6,0xf,0x9,0x3,0x8,0x0,0x7,
  57                          0xb,0x4,0x1,0xf,0x2,0xe,0xc,0x3,
  58                          0x5,0xb,0xa,0x5,0xe,0x2,0x7,0xc,
  59                  },
  60          
  61                  S_BOX4[64]= {
  62                          0x7,0xd,0xd,0x8,0xe,0xb,0x3,0x5,
  63                          0x0,0x6,0x6,0xf,0x9,0x0,0xa,0x3,
  64                          0x1,0x4,0x2,0x7,0x8,0x2,0x5,0xc,
  65                          0xb,0x1,0xc,0xa,0x4,0xe,0xf,0x9,
  66                          0xa,0x3,0x6,0xf,0x9,0x0,0x0,0x6,
  67                          0xc,0xa,0xb,0x1,0x7,0xd,0xd,0x8,
  68                          0xf,0x9,0x1,0x4,0x3,0x5,0xe,0xb,
  69                          0x5,0xc,0x2,0x7,0x8,0x2,0x4,0xe,
  70                  },
  71          
  72                  S_BOX5[64]= {
  73                          0x2,0xe,0xc,0xb,0x4,0x2,0x1,0xc,
  74                          0x7,0x4,0xa,0x7,0xb,0xd,0x6,0x1,
  75                          0x8,0x5,0x5,0x0,0x3,0xf,0xf,0xa,
  76                          0xd,0x3,0x0,0x9,0xe,0x8,0x9,0x6,
  77                          0x4,0xb,0x2,0x8,0x1,0xc,0xb,0x7,
  78                          0xa,0x1,0xd,0xe,0x7,0x2,0x8,0xd,
  79                          0xf,0x6,0x9,0xf,0xc,0x0,0x5,0x9,
  80                          0x6,0xa,0x3,0x4,0x0,0x5,0xe,0x3,
  81                  },
  82          
  83                  S_BOX6[64]= {
  84                          0xc,0xa,0x1,0xf,0xa,0x4,0xf,0x2,
  85                          0x9,0x7,0x2,0xc,0x6,0x9,0x8,0x5,
  86                          0x0,0x6,0xd,0x1,0x3,0xd,0x4,0xe,
  87                          0xe,0x0,0x7,0xb,0x5,0x3,0xb,0x8,
  88                          0x9,0x4,0xe,0x3,0xf,0x2,0x5,0xc,
  89                          0x2,0x9,0x8,0x5,0xc,0xf,0x3,0xa,
  90                          0x7,0xb,0x0,0xe,0x4,0x1,0xa,0x7,
  91                          0x1,0x6,0xd,0x0,0xb,0x8,0x6,0xd,
  92                  },
  93          
  94                  S_BOX7[64]= {
  95                          0x4,0xd,0xb,0x0,0x2,0xb,0xe,0x7,
  96                          0xf,0x4,0x0,0x9,0x8,0x1,0xd,0xa,
  97                          0x3,0xe,0xc,0x3,0x9,0x5,0x7,0xc,
  98                          0x5,0x2,0xa,0xf,0x6,0x8,0x1,0x6,
  99                          0x1,0x6,0x4,0xb,0xb,0xd,0xd,0x8,
 100                          0xc,0x1,0x3,0x4,0x7,0xa,0xe,0x7,
 101                          0xa,0x9,0xf,0x5,0x6,0x0,0x8,0xf,
 102                          0x0,0xe,0x5,0x2,0x9,0x3,0x2,0xc,
 103                  },
 104          
 105                  S_BOX8[64]= {
 106                          0xd,0x1,0x2,0xf,0x8,0xd,0x4,0x8,
 107                          0x6,0xa,0xf,0x3,0xb,0x7,0x1,0x4,
 108                          0xa,0xc,0x9,0x5,0x3,0x6,0xe,0xb,
 109                          0x5,0x0,0x0,0xe,0xc,0x9,0x7,0x2,
 110                          0x7,0x2,0xb,0x1,0x4,0xe,0x1,0x7,
 111                          0x9,0x4,0xc,0xa,0xe,0x8,0x2,0xd,
 112                          0x0,0xf,0x6,0xc,0xa,0x9,0xd,0x0,
 113                          0xf,0x3,0x3,0x5,0x5,0x6,0x8,0xb,
 114                  };
 115          
 116          void SubKey_Generation(uchar *key)
C51 COMPILER V9.54   DES                                                                   03/18/2019 11:21:00 PAGE 3   

 117          {
 118   1              uchar  xdata  i,j;
 119   1      
 120   1              memset (lk, 0, 4);
 121   1              memset (rk, 0, 4);
 122   1      
 123   1              // now PC1 permutation
 124   1              lk[3] = (lk[3] | (key[7] >> 7 & 0x01)) << 1;    //
 125   1              lk[3] = (lk[3] | (key[6] >> 7 & 0x01)) << 1;
 126   1              lk[3] = (lk[3] | (key[5] >> 7 & 0x01)) << 1;
 127   1              lk[3] = (lk[3] | (key[4] >> 7 & 0x01));
 128   1      
 129   1              lk[2] = (lk[2] | (key[3] >> 7 & 0x01)) << 1;
 130   1              lk[2] = (lk[2] | (key[2] >> 7 & 0x01)) << 1;
 131   1              lk[2] = (lk[2] | (key[1] >> 7 & 0x01)) << 1;
 132   1              lk[2] = (lk[2] | (key[0] >> 7 & 0x01)) << 1;
 133   1              lk[2] = (lk[2] | (key[7] >> 6 & 0x01)) << 1;
 134   1              lk[2] = (lk[2] | (key[6] >> 6 & 0x01)) << 1;
 135   1              lk[2] = (lk[2] | (key[5] >> 6 & 0x01)) << 1;
 136   1              lk[2] = (lk[2] | (key[4] >> 6 & 0x01));
 137   1      
 138   1              lk[1] = (lk[1] | (key[3] >> 6 & 0x01)) << 1;
 139   1              lk[1] = (lk[1] | (key[2] >> 6 & 0x01)) << 1;
 140   1              lk[1] = (lk[1] | (key[1] >> 6 & 0x01)) << 1;
 141   1              lk[1] = (lk[1] | (key[0] >> 6 & 0x01)) << 1;
 142   1              lk[1] = (lk[1] | (key[7] >> 5 & 0x01)) << 1;
 143   1              lk[1] = (lk[1] | (key[6] >> 5 & 0x01)) << 1;
 144   1              lk[1] = (lk[1] | (key[5] >> 5 & 0x01)) << 1;
 145   1              lk[1] = (lk[1] | (key[4] >> 5 & 0x01));
 146   1      
 147   1              lk[0] = (lk[0] | (key[3] >> 5 & 0x01)) << 1;
 148   1              lk[0] = (lk[0] | (key[2] >> 5 & 0x01)) << 1;
 149   1              lk[0] = (lk[0] | (key[1] >> 5 & 0x01)) << 1;
 150   1              lk[0] = (lk[0] | (key[0] >> 5 & 0x01)) << 1;
 151   1              lk[0] = (lk[0] | (key[7] >> 4 & 0x01)) << 1;
 152   1              lk[0] = (lk[0] | (key[6] >> 4 & 0x01)) << 1;
 153   1              lk[0] = (lk[0] | (key[5] >> 4 & 0x01)) << 1;
 154   1              lk[0] = (lk[0] | (key[4] >> 4 & 0x01));
 155   1      
 156   1              rk[3] = (rk[3] | (key[7] >> 1 & 0x01)) << 1;
 157   1              rk[3] = (rk[3] | (key[6] >> 1 & 0x01)) << 1;
 158   1              rk[3] = (rk[3] | (key[5] >> 1 & 0x01)) << 1;
 159   1              rk[3] = (rk[3] | (key[4] >> 1 & 0x01));
 160   1      
 161   1              rk[2] = (rk[2] | (key[3] >> 1 & 0x01)) << 1;
 162   1              rk[2] = (rk[2] | (key[2] >> 1 & 0x01)) << 1;
 163   1              rk[2] = (rk[2] | (key[1] >> 1 & 0x01)) << 1;
 164   1              rk[2] = (rk[2] | (key[0] >> 1 & 0x01)) << 1;
 165   1              rk[2] = (rk[2] | (key[7] >> 2 & 0x01)) << 1;
 166   1              rk[2] = (rk[2] | (key[6] >> 2 & 0x01)) << 1;
 167   1              rk[2] = (rk[2] | (key[5] >> 2 & 0x01)) << 1;
 168   1              rk[2] = (rk[2] | (key[4] >> 2 & 0x01));
 169   1      
 170   1              rk[1] = (rk[1] | (key[3] >> 2 & 0x01)) << 1;
 171   1              rk[1] = (rk[1] | (key[2] >> 2 & 0x01)) << 1;
 172   1              rk[1] = (rk[1] | (key[1] >> 2 & 0x01)) << 1;
 173   1              rk[1] = (rk[1] | (key[0] >> 2 & 0x01)) << 1;
 174   1              rk[1] = (rk[1] | (key[7] >> 3 & 0x01)) << 1;
 175   1              rk[1] = (rk[1] | (key[6] >> 3 & 0x01)) << 1;
 176   1              rk[1] = (rk[1] | (key[5] >> 3 & 0x01)) << 1;
 177   1              rk[1] = (rk[1] | (key[4] >> 3 & 0x01));
 178   1      
C51 COMPILER V9.54   DES                                                                   03/18/2019 11:21:00 PAGE 4   

 179   1              rk[0] = (rk[0] | (key[3] >> 3 & 0x01)) << 1;
 180   1              rk[0] = (rk[0] | (key[2] >> 3 & 0x01)) << 1;
 181   1              rk[0] = (rk[0] | (key[1] >> 3 & 0x01)) << 1;
 182   1              rk[0] = (rk[0] | (key[0] >> 3 & 0x01)) << 1;
 183   1              rk[0] = (rk[0] | (key[3] >> 4 & 0x01)) << 1;
 184   1              rk[0] = (rk[0] | (key[2] >> 4 & 0x01)) << 1;
 185   1              rk[0] = (rk[0] | (key[1] >> 4 & 0x01)) << 1;
 186   1              rk[0] = (rk[0] | (key[0] >> 4 & 0x01));
 187   1      
 188   1              lk[3] &= 0x0F;
 189   1              rk[3] &= 0x0F;
 190   1      
 191   1              for(i=0; i<=16; i++)
 192   1              {
 193   2                      j = 6*i;
 194   2      
 195   2                      skey[5]=0;
 196   2                      skey[4]=0;
 197   2                      skey[3]=0;
 198   2                      skey[2]=0;
 199   2                      skey[1]=0;
 200   2                      skey[0]=0;
 201   2      
 202   2                      if(ls[i] == 1)
 203   2                      {
 204   3                              lk[3] = (lk[3] << 1 | lk[2] >> 7);
 205   3                              lk[2] = (lk[2] << 1 | lk[1] >> 7);
 206   3                              lk[1] = (lk[1] << 1 | lk[0] >> 7);
 207   3                              lk[0] = (lk[0] << 1 | lk[3] >> 4);
 208   3      
 209   3                              lk[3] &= 0x0F;
 210   3      
 211   3                              rk[3] = (rk[3] << 1 | rk[2] >> 7);
 212   3                              rk[2] = (rk[2] << 1 | rk[1] >> 7);
 213   3                              rk[1] = (rk[1] << 1 | rk[0] >> 7);
 214   3                              rk[0] = (rk[0] << 1 | rk[3] >> 4);
 215   3      
 216   3                              rk[3] &= 0x0F;
 217   3                      }
 218   2                      else // ls[i] == 2
 219   2                      {
 220   3                              lk[3] = (lk[3] << 2 | lk[2] >> 6);
 221   3                              lk[2] = (lk[2] << 2 | lk[1] >> 6);
 222   3                              lk[1] = (lk[1] << 2 | lk[0] >> 6);
 223   3                              lk[0] = (lk[0] << 2 | lk[3] >> 4);
 224   3      
 225   3                              lk[3] &= 0x0F;
 226   3      
 227   3                              rk[3] = (rk[3] << 2 | rk[2] >> 6);
 228   3                              rk[2] = (rk[2] << 2 | rk[1] >> 6);
 229   3                              rk[1] = (rk[1] << 2 | rk[0] >> 6);
 230   3                              rk[0] = (rk[0] << 2 | rk[3] >> 4);
 231   3      
 232   3                              rk[3] &= 0x0F;
 233   3                      }
 234   2      
 235   2      
 236   2                      // now PC2 permutation
 237   2                      skey[5] = (skey[5] | (lk[1] >> 6 & 0x01)) << 1;
 238   2                      skey[5] = (skey[5] | (lk[1] >> 3 & 0x01)) << 1;
 239   2                      skey[5] = (skey[5] | (lk[2] >> 1 & 0x01)) << 1;
 240   2                      skey[5] = (skey[5] | (lk[0] >> 4 & 0x01)) << 1;
C51 COMPILER V9.54   DES                                                                   03/18/2019 11:21:00 PAGE 5   

 241   2                      skey[5] = (skey[5] | (lk[3] >> 3 & 0x01)) << 1;
 242   2                      skey[5] = (skey[5] | (lk[2] >> 7 & 0x01)) << 1;
 243   2                      skey[5] = (skey[5] | (lk[3] >> 1 & 0x01)) << 1;
 244   2                      skey[5] = (skey[5] | (lk[0]      & 0x01));
 245   2      
 246   2                      enckey[j+5] = skey[5];
 247   2      
 248   2                      skey[4] = (skey[4] | (lk[1] >> 5 & 0x01)) << 1;
 249   2                      skey[4] = (skey[4] | (lk[2] >> 6 & 0x01)) << 1;
 250   2                      skey[4] = (skey[4] | (lk[0] >> 7 & 0x01)) << 1;
 251   2                      skey[4] = (skey[4] | (lk[2] >> 2 & 0x01)) << 1;
 252   2                      skey[4] = (skey[4] | (lk[0] >> 5 & 0x01)) << 1;
 253   2                      skey[4] = (skey[4] | (lk[1] >> 1 & 0x01)) << 1;
 254   2                      skey[4] = (skey[4] | (lk[2]      & 0x01)) << 1;
 255   2                      skey[4] = (skey[4] | (lk[3]      & 0x01));
 256   2      
 257   2                      enckey[j+4] = skey[4];
 258   2      
 259   2                      skey[3] = (skey[3] | (lk[0] >> 2 & 0x01)) << 1;
 260   2                      skey[3] = (skey[3] | (lk[2] >> 4 & 0x01)) << 1;
 261   2                      skey[3] = (skey[3] | (lk[1] >> 4 & 0x01)) << 1;
 262   2                      skey[3] = (skey[3] | (lk[2] >> 5 & 0x01)) << 1;
 263   2                      skey[3] = (skey[3] | (lk[0] >> 1 & 0x01)) << 1;
 264   2                      skey[3] = (skey[3] | (lk[1]      & 0x01)) << 1;
 265   2                      skey[3] = (skey[3] | (lk[1] >> 7 & 0x01)) << 1;
 266   2                      skey[3] = (skey[3] | (lk[3] >> 2 & 0x01));
 267   2      
 268   2                      enckey[j+3] = skey[3];
 269   2      
 270   2                      skey[2] = (skey[2] | (rk[1] >> 7 & 0x01)) << 1;
 271   2                      skey[2] = (skey[2] | (rk[0] >> 4 & 0x01)) << 1;
 272   2                      skey[2] = (skey[2] | (rk[3] >> 1 & 0x01)) << 1;
 273   2                      skey[2] = (skey[2] | (rk[2] >> 3 & 0x01)) << 1;
 274   2                      skey[2] = (skey[2] | (rk[1] >> 1 & 0x01)) << 1;
 275   2                      skey[2] = (skey[2] | (rk[0] >> 1 & 0x01)) << 1;
 276   2                      skey[2] = (skey[2] | (rk[3] >> 2 & 0x01)) << 1;
 277   2                      skey[2] = (skey[2] | (rk[2]      & 0x01));
 278   2      
 279   2                      enckey[j+2] = skey[2];
 280   2      
 281   2                      skey[1] = (skey[1] | (rk[0] >> 5 & 0x01)) << 1;
 282   2                      skey[1] = (skey[1] | (rk[1] >> 3 & 0x01)) << 1;
 283   2                      skey[1] = (skey[1] | (rk[2] >> 7 & 0x01)) << 1;
 284   2                      skey[1] = (skey[1] | (rk[1]      & 0x01)) << 1;
 285   2                      skey[1] = (skey[1] | (rk[1] >> 4 & 0x01)) << 1;
 286   2                      skey[1] = (skey[1] | (rk[0] >> 7 & 0x01)) << 1;
 287   2                      skey[1] = (skey[1] | (rk[2] >> 1 & 0x01)) << 1;
 288   2                      skey[1] = (skey[1] | (rk[0]      & 0x01));
 289   2      
 290   2                      enckey[j+1] = skey[1];
 291   2      
 292   2                      skey[0] = (skey[0] | (rk[2] >> 6 & 0x01)) << 1;
 293   2                      skey[0] = (skey[0] | (rk[0] >> 3 & 0x01)) << 1;
 294   2                      skey[0] = (skey[0] | (rk[1] >> 2 & 0x01)) << 1;
 295   2                      skey[0] = (skey[0] | (rk[1] >> 6 & 0x01)) << 1;
 296   2                      skey[0] = (skey[0] | (rk[0] >> 6 & 0x01)) << 1;
 297   2                      skey[0] = (skey[0] | (rk[2] >> 4 & 0x01)) << 1;
 298   2                      skey[0] = (skey[0] | (rk[3] >> 3 & 0x01)) << 1;
 299   2                      skey[0] = (skey[0] | (rk[3]      & 0x01));
 300   2      
 301   2                      enckey[j] = skey[0];
 302   2              }
C51 COMPILER V9.54   DES                                                                   03/18/2019 11:21:00 PAGE 6   

 303   1       
 304   1              for(i=0;i<8;i++) // create decription subkeys...
 305   1              {
 306   2                      memcpy(deckey+6*i, enckey+(90-6*i), 6);
 307   2                      memcpy(deckey+(90-6*i), enckey+6*i, 6);
 308   2              }
 309   1      }
 310          
 311          
 312          
 313          void IniPer(uchar *src)
 314          {
 315   1              memset(oo, 0, 4);
 316   1              memset(pp, 0, 4);
 317   1      
 318   1      //  oo[3] = src[7].6 | src[6].6 | src[5].6 | src[4].6 | src[3].6 | src[2].6 | src[1].6 | src[0].6;
 319   1              oo[3] = (oo[3] | (src[7] >> 6 & 0x01)) << 1;
 320   1              oo[3] = (oo[3] | (src[6] >> 6 & 0x01)) << 1;
 321   1              oo[3] = (oo[3] | (src[5] >> 6 & 0x01)) << 1;
 322   1              oo[3] = (oo[3] | (src[4] >> 6 & 0x01)) << 1;
 323   1              oo[3] = (oo[3] | (src[3] >> 6 & 0x01)) << 1;
 324   1              oo[3] = (oo[3] | (src[2] >> 6 & 0x01)) << 1;
 325   1              oo[3] = (oo[3] | (src[1] >> 6 & 0x01)) << 1;
 326   1              oo[3] = (oo[3] | (src[0] >> 6 & 0x01));
 327   1      
 328   1      
 329   1      //      oo[2] = src[7].4 | src[6].4 | src[5].4 | src[4].4 | src[3].4 | src[2].4 | src[1].4 | src[0].4;
 330   1              oo[2] = (oo[2] | (src[7] >> 4 & 0x01)) << 1;
 331   1              oo[2] = (oo[2] | (src[6] >> 4 & 0x01)) << 1;
 332   1              oo[2] = (oo[2] | (src[5] >> 4 & 0x01)) << 1;
 333   1              oo[2] = (oo[2] | (src[4] >> 4 & 0x01)) << 1;
 334   1              oo[2] = (oo[2] | (src[3] >> 4 & 0x01)) << 1;
 335   1              oo[2] = (oo[2] | (src[2] >> 4 & 0x01)) << 1;
 336   1              oo[2] = (oo[2] | (src[1] >> 4 & 0x01)) << 1;
 337   1              oo[2] = (oo[2] | (src[0] >> 4 & 0x01));
 338   1      
 339   1      //      oo[1] = src[7].2 | src[6].2 | src[5].2 | src[4].2 | src[3].2 | src[2].2 | src[1].2 | src[0].2;
 340   1              oo[1] = (oo[1] | (src[7] >> 2 & 0x01)) << 1;
 341   1              oo[1] = (oo[1] | (src[6] >> 2 & 0x01)) << 1;
 342   1              oo[1] = (oo[1] | (src[5] >> 2 & 0x01)) << 1;
 343   1              oo[1] = (oo[1] | (src[4] >> 2 & 0x01)) << 1;
 344   1              oo[1] = (oo[1] | (src[3] >> 2 & 0x01)) << 1;
 345   1              oo[1] = (oo[1] | (src[2] >> 2 & 0x01)) << 1;
 346   1              oo[1] = (oo[1] | (src[1] >> 2 & 0x01)) << 1;
 347   1              oo[1] = (oo[1] | (src[0] >> 2 & 0x01));
 348   1      
 349   1      //      oo[0] = src[7].0 | src[6].0 | src[5].0 | src[4].0 | src[3].0 | src[2].0 | src[1].0 | src[0].0;
 350   1              oo[0] = (oo[0] | (src[7]      & 0x01)) << 1;
 351   1              oo[0] = (oo[0] | (src[6]      & 0x01)) << 1;
 352   1              oo[0] = (oo[0] | (src[5]      & 0x01)) << 1;
 353   1              oo[0] = (oo[0] | (src[4]      & 0x01)) << 1;
 354   1              oo[0] = (oo[0] | (src[3]      & 0x01)) << 1;
 355   1              oo[0] = (oo[0] | (src[2]      & 0x01)) << 1;
 356   1              oo[0] = (oo[0] | (src[1]      & 0x01)) << 1;
 357   1              oo[0] = (oo[0] | (src[0]      & 0x01));
 358   1      
 359   1      //      pp[3] = src[7].7 | src[6].7 | src[5].7 | src[4].7 | src[3].7 | src[2].7 | src[1].7 | src[0].7;
 360   1              pp[3] = (pp[3] | (src[7] >> 7 & 0x01)) << 1;
 361   1              pp[3] = (pp[3] | (src[6] >> 7 & 0x01)) << 1;
 362   1              pp[3] = (pp[3] | (src[5] >> 7 & 0x01)) << 1;
 363   1              pp[3] = (pp[3] | (src[4] >> 7 & 0x01)) << 1;
 364   1              pp[3] = (pp[3] | (src[3] >> 7 & 0x01)) << 1;
C51 COMPILER V9.54   DES                                                                   03/18/2019 11:21:00 PAGE 7   

 365   1              pp[3] = (pp[3] | (src[2] >> 7 & 0x01)) << 1;
 366   1              pp[3] = (pp[3] | (src[1] >> 7 & 0x01)) << 1;
 367   1              pp[3] = (pp[3] | (src[0] >> 7 & 0x01));
 368   1      
 369   1      
 370   1      //      pp[2] = src[7].5 | src[6].5 | src[5].5 | src[4].5 | src[3].5 | src[2].5 | src[1].5 | src[0].5;
 371   1              pp[2] = (pp[2] | (src[7] >> 5 & 0x01)) << 1;
 372   1              pp[2] = (pp[2] | (src[6] >> 5 & 0x01)) << 1;
 373   1              pp[2] = (pp[2] | (src[5] >> 5 & 0x01)) << 1;
 374   1              pp[2] = (pp[2] | (src[4] >> 5 & 0x01)) << 1;
 375   1              pp[2] = (pp[2] | (src[3] >> 5 & 0x01)) << 1;
 376   1              pp[2] = (pp[2] | (src[2] >> 5 & 0x01)) << 1;
 377   1              pp[2] = (pp[2] | (src[1] >> 5 & 0x01)) << 1;
 378   1              pp[2] = (pp[2] | (src[0] >> 5 & 0x01));
 379   1      
 380   1      
 381   1      //      pp[1] = src[7].3 | src[6].3 | src[5].3 | src[4].3 | src[3].3 | src[2].3 | src[1].3 | src[0].3;
 382   1              pp[1] = (pp[1] | (src[7] >> 3 & 0x01)) << 1;
 383   1              pp[1] = (pp[1] | (src[6] >> 3 & 0x01)) << 1;
 384   1              pp[1] = (pp[1] | (src[5] >> 3 & 0x01)) << 1;
 385   1              pp[1] = (pp[1] | (src[4] >> 3 & 0x01)) << 1;
 386   1              pp[1] = (pp[1] | (src[3] >> 3 & 0x01)) << 1;
 387   1              pp[1] = (pp[1] | (src[2] >> 3 & 0x01)) << 1;
 388   1              pp[1] = (pp[1] | (src[1] >> 3 & 0x01)) << 1;
 389   1              pp[1] = (pp[1] | (src[0] >> 3 & 0x01));
 390   1      
 391   1      
 392   1      //      pp[0] = src[7].1 | src[6].1 | src[5].1 | src[4].1 | src[3].1 | src[2].1 | src[1].1 | src[0].1;
 393   1              pp[0] = (pp[0] | (src[7] >> 1 & 0x01)) << 1;
 394   1              pp[0] = (pp[0] | (src[6] >> 1 & 0x01)) << 1;
 395   1              pp[0] = (pp[0] | (src[5] >> 1 & 0x01)) << 1;
 396   1              pp[0] = (pp[0] | (src[4] >> 1 & 0x01)) << 1;
 397   1              pp[0] = (pp[0] | (src[3] >> 1 & 0x01)) << 1;
 398   1              pp[0] = (pp[0] | (src[2] >> 1 & 0x01)) << 1;
 399   1              pp[0] = (pp[0] | (src[1] >> 1 & 0x01)) << 1;
 400   1              pp[0] = (pp[0] | (src[0] >> 1 & 0x01));
 401   1      }
 402          
 403          
 404          void desfun(uchar *subkey)
 405          {
 406   1              memset(blck, 0, 9);
 407   1      
 408   1              fnc[0] = 0;
 409   1              fnc[1] = 0;
 410   1              fnc[2] = 0;
 411   1              fnc[3] = 0;
 412   1      
 413   1              blck[8] = (pp[0] & 0x0F) << 1;
 414   1              blck[7] = (pp[0] >> 4 & 0x0F) << 1;
 415   1              blck[6] = (pp[1] & 0x0F) << 1;
 416   1              blck[5] = (pp[1] >> 4 & 0x0F) << 1;
 417   1              blck[4] = (pp[2] & 0x0F) << 1;
 418   1              blck[3] = (pp[2] >> 4 & 0x0F) << 1;
 419   1              blck[2] = (pp[3] & 0x0F) << 1;
 420   1              blck[1] = (pp[3] >> 4 & 0x0F) << 1;
 421   1      
 422   1      
 423   1              blck[1] |= (blck[8] & 0x02) << 4;
 424   1              blck[1] |= (blck[2] & 0x10) >> 4;
 425   1      
 426   1              blck[2] |= (blck[1] & 0x02) << 4;
C51 COMPILER V9.54   DES                                                                   03/18/2019 11:21:00 PAGE 8   

 427   1              blck[2] |= (blck[3] & 0x10) >> 4;
 428   1      
 429   1              blck[3] |= (blck[2] & 0x02) << 4;
 430   1              blck[3] |= (blck[4] & 0x10) >> 4;
 431   1      
 432   1              blck[4] |= (blck[3] & 0x02) << 4;
 433   1              blck[4] |= (blck[5] & 0x10) >> 4;
 434   1      
 435   1              blck[5] |= (blck[4] & 0x02) << 4;
 436   1              blck[5] |= (blck[6] & 0x10) >> 4;
 437   1      
 438   1              blck[6] |= (blck[5] & 0x02) << 4;
 439   1              blck[6] |= (blck[7] & 0x10) >> 4;
 440   1      
 441   1              blck[7] |= (blck[6] & 0x02) << 4;
 442   1              blck[7] |= (blck[8] & 0x10) >> 4;
 443   1      
 444   1              blck[8] |= (blck[7] & 0x02) << 4;
 445   1              blck[8] |= (blck[1] & 0x10) >> 4;
 446   1      
 447   1              blck[1] ^= (subkey[5] & 0xfc) >> 2;
 448   1              blck[2] ^= ((subkey[5] & 0x03) << 4) | ((subkey[4] & 0xf0) >> 4);
 449   1              blck[3] ^= ((subkey[4] & 0x0f) << 2) | ((subkey[3] & 0xc0) >> 6);
 450   1              blck[4] ^= subkey[3] & 0x3f;
 451   1              blck[5] ^= (subkey[2] & 0xfc) >> 2;
 452   1              blck[6] ^= ((subkey[2] & 0x03) << 4) | ((subkey[1] & 0xf0) >> 4);
 453   1              blck[7] ^= ((subkey[1] & 0x0f) << 2) | ((subkey[0] & 0xc0) >> 6);
 454   1              blck[8] ^= subkey[0] & 0x3f;
 455   1      
 456   1              blck[1] = S_BOX1[blck[1]];
 457   1              blck[2] = S_BOX2[blck[2]];
 458   1              blck[3] = S_BOX3[blck[3]];
 459   1              blck[4] = S_BOX4[blck[4]];
 460   1              blck[5] = S_BOX5[blck[5]];
 461   1              blck[6] = S_BOX6[blck[6]];
 462   1              blck[7] = S_BOX7[blck[7]];
 463   1              blck[8] = S_BOX8[blck[8]];
 464   1      
 465   1              //fnc[3] = b[4].0 | b[2].1 | b[5].0 | b[6].3 | b[8].3 | b[3].0 | b[7].0 | b[5].3;
 466   1              fnc[3] = (fnc[3] | (blck[4]      & 0x01)) << 1;
 467   1              fnc[3] = (fnc[3] | (blck[2] >> 1 & 0x01)) << 1;
 468   1              fnc[3] = (fnc[3] | (blck[5]      & 0x01)) << 1;
 469   1              fnc[3] = (fnc[3] | (blck[6] >> 3 & 0x01)) << 1;
 470   1              fnc[3] = (fnc[3] | (blck[8] >> 3 & 0x01)) << 1;
 471   1              fnc[3] = (fnc[3] | (blck[3]      & 0x01)) << 1;
 472   1              fnc[3] = (fnc[3] | (blck[7]      & 0x01)) << 1;
 473   1              fnc[3] = (fnc[3] | (blck[5] >> 3 & 0x01));
 474   1      
 475   1              //fnc[2] = b[1].3 | b[4].1 | b[6].1 | b[7].2 | b[2].3 | b[5].2 | b[8].1 | b[3].2;
 476   1              fnc[2] = (fnc[2] | (blck[1] >> 3 & 0x01)) << 1;
 477   1              fnc[2] = (fnc[2] | (blck[4] >> 1 & 0x01)) << 1;
 478   1              fnc[2] = (fnc[2] | (blck[6] >> 1 & 0x01)) << 1;
 479   1              fnc[2] = (fnc[2] | (blck[7] >> 2 & 0x01)) << 1;
 480   1              fnc[2] = (fnc[2] | (blck[2] >> 3 & 0x01)) << 1;
 481   1              fnc[2] = (fnc[2] | (blck[5] >> 2 & 0x01)) << 1;
 482   1              fnc[2] = (fnc[2] | (blck[8] >> 1 & 0x01)) << 1;
 483   1              fnc[2] = (fnc[2] | (blck[3] >> 2 & 0x01));
 484   1      
 485   1              //fnc[1] = b[1].2 | b[2].0 | b[6].0 | b[4].2 | b[8].0 | b[7].1 | b[1].1 | b[3].3;
 486   1              fnc[1] = (fnc[1] | (blck[1] >> 2 & 0x01)) << 1;
 487   1              fnc[1] = (fnc[1] | (blck[2]      & 0x01)) << 1;
 488   1              fnc[1] = (fnc[1] | (blck[6]      & 0x01)) << 1;
C51 COMPILER V9.54   DES                                                                   03/18/2019 11:21:00 PAGE 9   

 489   1              fnc[1] = (fnc[1] | (blck[4] >> 2 & 0x01)) << 1;
 490   1              fnc[1] = (fnc[1] | (blck[8]      & 0x01)) << 1;
 491   1              fnc[1] = (fnc[1] | (blck[7] >> 1 & 0x01)) << 1;
 492   1              fnc[1] = (fnc[1] | (blck[1] >> 1 & 0x01)) << 1;
 493   1              fnc[1] = (fnc[1] | (blck[3] >> 3 & 0x01));
 494   1      
 495   1              //fnc[0] = b[5].1 | b[4].3 | b[8].2 | b[2].2 | b[6].2 | b[3].1 | b[1].0 | b[7].3;
 496   1              fnc[0] = (fnc[0] | (blck[5] >> 1 & 0x01)) << 1;
 497   1              fnc[0] = (fnc[0] | (blck[4] >> 3 & 0x01)) << 1;
 498   1              fnc[0] = (fnc[0] | (blck[8] >> 2 & 0x01)) << 1;
 499   1              fnc[0] = (fnc[0] | (blck[2] >> 2 & 0x01)) << 1;
 500   1              fnc[0] = (fnc[0] | (blck[6] >> 2 & 0x01)) << 1;
 501   1              fnc[0] = (fnc[0] | (blck[3] >> 1 & 0x01)) << 1;
 502   1              fnc[0] = (fnc[0] | (blck[1]      & 0x01)) << 1;
 503   1              fnc[0] = (fnc[0] | (blck[7] >> 3 & 0x01));
 504   1      }
 505          
 506          void FinalPer(uchar *result)
 507          {
 508   1              memset(result, 0, 8);
 509   1      
 510   1      //      result[0] = pp[3].0 | oo[3].0 | pp[2].0 | oo[2].0 | pp[1].0 | oo[1].0 | pp[0].0 | oo[0].0;
 511   1              result[0] = (result[0] | (pp[3] & 0x01)) << 1;
 512   1              result[0] = (result[0] | (oo[3] & 0x01)) << 1;
 513   1              result[0] = (result[0] | (pp[2] & 0x01)) << 1;
 514   1              result[0] = (result[0] | (oo[2] & 0x01)) << 1;
 515   1              result[0] = (result[0] | (pp[1] & 0x01)) << 1;
 516   1              result[0] = (result[0] | (oo[1] & 0x01)) << 1;
 517   1              result[0] = (result[0] | (pp[0] & 0x01)) << 1;
 518   1              result[0] = (result[0] | (oo[0] & 0x01));
 519   1      
 520   1      
 521   1      //      result[1] = pp[3].1 | oo[3].1 | pp[2].1 | oo[2].1 | pp[1].1 | oo[1].1 | pp[0].1 | oo[0].1;
 522   1              result[1] = (result[1] | (pp[3] >> 1 & 0x01)) << 1;
 523   1              result[1] = (result[1] | (oo[3] >> 1 & 0x01)) << 1;
 524   1              result[1] = (result[1] | (pp[2] >> 1 & 0x01)) << 1;
 525   1              result[1] = (result[1] | (oo[2] >> 1 & 0x01)) << 1;
 526   1              result[1] = (result[1] | (pp[1] >> 1 & 0x01)) << 1;
 527   1              result[1] = (result[1] | (oo[1] >> 1 & 0x01)) << 1;
 528   1              result[1] = (result[1] | (pp[0] >> 1 & 0x01)) << 1;
 529   1              result[1] = (result[1] | (oo[0] >> 1 & 0x01));
 530   1      
 531   1      //      result[2] = pp[3].2 | oo[3].2 | pp[2].2 | oo[2].2 | pp[1].2 | oo[1].2 | pp[0].2 | oo[0].2;
 532   1              result[2] = (result[2] | (pp[3] >> 2 & 0x01)) << 1;
 533   1              result[2] = (result[2] | (oo[3] >> 2 & 0x01)) << 1;
 534   1              result[2] = (result[2] | (pp[2] >> 2 & 0x01)) << 1;
 535   1              result[2] = (result[2] | (oo[2] >> 2 & 0x01)) << 1;
 536   1              result[2] = (result[2] | (pp[1] >> 2 & 0x01)) << 1;
 537   1              result[2] = (result[2] | (oo[1] >> 2 & 0x01)) << 1;
 538   1              result[2] = (result[2] | (pp[0] >> 2 & 0x01)) << 1;
 539   1              result[2] = (result[2] | (oo[0] >> 2 & 0x01));
 540   1      
 541   1      //      result[3] = pp[3].3 | oo[3].3 | pp[2].3 | oo[2].3 | pp[1].3 | oo[1].3 | pp[0].3 | oo[0].3;
 542   1              result[3] = (result[3] | (pp[3] >> 3 & 0x01)) << 1;
 543   1              result[3] = (result[3] | (oo[3] >> 3 & 0x01)) << 1;
 544   1              result[3] = (result[3] | (pp[2] >> 3 & 0x01)) << 1;
 545   1              result[3] = (result[3] | (oo[2] >> 3 & 0x01)) << 1;
 546   1              result[3] = (result[3] | (pp[1] >> 3 & 0x01)) << 1;
 547   1              result[3] = (result[3] | (oo[1] >> 3 & 0x01)) << 1;
 548   1              result[3] = (result[3] | (pp[0] >> 3 & 0x01)) << 1;
 549   1              result[3] = (result[3] | (oo[0] >> 3 & 0x01));
 550   1      
C51 COMPILER V9.54   DES                                                                   03/18/2019 11:21:00 PAGE 10  

 551   1      
 552   1      //      result[4] = pp[3].4 | oo[3].4 | pp[2].4 | oo[2].4 | pp[1].4 | oo[1].4 | pp[0].4 | oo[0].4;
 553   1              result[4] = (result[4] | (pp[3] >> 4 & 0x01)) << 1;
 554   1              result[4] = (result[4] | (oo[3] >> 4 & 0x01)) << 1;
 555   1              result[4] = (result[4] | (pp[2] >> 4 & 0x01)) << 1;
 556   1              result[4] = (result[4] | (oo[2] >> 4 & 0x01)) << 1;
 557   1              result[4] = (result[4] | (pp[1] >> 4 & 0x01)) << 1;
 558   1              result[4] = (result[4] | (oo[1] >> 4 & 0x01)) << 1;
 559   1              result[4] = (result[4] | (pp[0] >> 4 & 0x01)) << 1;
 560   1              result[4] = (result[4] | (oo[0] >> 4 & 0x01));
 561   1      
 562   1      //      result[5] = pp[3].5 | oo[3].5 | pp[2].5 | oo[2].5 | pp[1].5 | oo[1].5 | pp[0].5 | oo[0].5;
 563   1              result[5] = (result[5] | (pp[3] >> 5 & 0x01)) << 1;
 564   1              result[5] = (result[5] | (oo[3] >> 5 & 0x01)) << 1;
 565   1              result[5] = (result[5] | (pp[2] >> 5 & 0x01)) << 1;
 566   1              result[5] = (result[5] | (oo[2] >> 5 & 0x01)) << 1;
 567   1              result[5] = (result[5] | (pp[1] >> 5 & 0x01)) << 1;
 568   1              result[5] = (result[5] | (oo[1] >> 5 & 0x01)) << 1;
 569   1              result[5] = (result[5] | (pp[0] >> 5 & 0x01)) << 1;
 570   1              result[5] = (result[5] | (oo[0] >> 5 & 0x01));
 571   1      
 572   1      //      result[6] = pp[3].6 | oo[3].6 | pp[2].6 | oo[2].6 | pp[1].6 | oo[1].6 | pp[0].6 | oo[0].6;
 573   1              result[6] = (result[6] | (pp[3] >> 6 & 0x01)) << 1;
 574   1              result[6] = (result[6] | (oo[3] >> 6 & 0x01)) << 1;
 575   1              result[6] = (result[6] | (pp[2] >> 6 & 0x01)) << 1;
 576   1              result[6] = (result[6] | (oo[2] >> 6 & 0x01)) << 1;
 577   1              result[6] = (result[6] | (pp[1] >> 6 & 0x01)) << 1;
 578   1              result[6] = (result[6] | (oo[1] >> 6 & 0x01)) << 1;
 579   1              result[6] = (result[6] | (pp[0] >> 6 & 0x01)) << 1;
 580   1              result[6] = (result[6] | (oo[0] >> 6 & 0x01));
 581   1      
 582   1      //      result[7] = pp[3].7 | oo[3].7 | pp[2].7 | oo[2].7 | pp[1].7 | oo[1].7 | pp[0].7 | oo[0].7;
 583   1              result[7] = (result[7] | (pp[3] >> 7 & 0x01)) << 1;
 584   1              result[7] = (result[7] | (oo[3] >> 7 & 0x01)) << 1;
 585   1              result[7] = (result[7] | (pp[2] >> 7 & 0x01)) << 1;
 586   1              result[7] = (result[7] | (oo[2] >> 7 & 0x01)) << 1;
 587   1              result[7] = (result[7] | (pp[1] >> 7 & 0x01)) << 1;
 588   1              result[7] = (result[7] | (oo[1] >> 7 & 0x01)) << 1;
 589   1              result[7] = (result[7] | (pp[0] >> 7 & 0x01)) << 1;
 590   1              result[7] = (result[7] | (oo[0] >> 7 & 0x01));
 591   1      }
 592          
 593          void des_16(uchar *src, uchar *subkey, uchar *result)
 594          {
 595   1              uchar i,j;
 596   1              uchar fout[4]={0,0,0,0};
 597   1      
 598   1          IniPer(src); // output :
 599   1      
 600   1              for(i=0;i<15;i++)
 601   1              {
 602   2                      j = i*6;
 603   2      
 604   2                      desfun(subkey+j); // create fnc[3]..fnc[0]
 605   2      
 606   2                      fout[3] = oo[3]^fnc[3];
 607   2                      fout[2] = oo[2]^fnc[2];
 608   2                      fout[1] = oo[1]^fnc[1];
 609   2                      fout[0] = oo[0]^fnc[0];
 610   2      
 611   2                      memcpy(oo, pp, 4);
 612   2                      memcpy(pp, fout, 4);
C51 COMPILER V9.54   DES                                                                   03/18/2019 11:21:00 PAGE 11  

 613   2              }
 614   1      
 615   1              j = i*6;
 616   1              desfun(subkey+j);
 617   1      
 618   1              oo[3] ^= fnc[3];
 619   1              oo[2] ^= fnc[2];
 620   1              oo[1] ^= fnc[1];
 621   1              oo[0] ^= fnc[0];
 622   1      
 623   1              FinalPer(result); // create grslt[0]..grslt[7]
 624   1      }
 625          
 626          
 627          void Single_DES_Decrypt_Encrypt(uchar mode, uchar *src, uchar *key, uchar *result)  //解密        :       明文   、
             -密
 628          {
 629   1              if(mode==1)//为1是解密,为0是加密
 630   1              {
 631   2                      SubKey_Generation(key); //enckey[6*16], deckey[6*16]
 632   2                      des_16(src, deckey, result);  // decrypted data 解密了的数据
 633   2              }
 634   1              else 
 635   1              {
 636   2                      SubKey_Generation(key);  //  enckey[6*16], deckey[6*16]
 637   2                      des_16(src, enckey, result);  // encrypted data
 638   2              }
 639   1      }
 640          
 641          
 642                                                                                                          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   6553    ----
   CONSTANT SIZE    =    516    ----
   XDATA SIZE       =    243      39
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
